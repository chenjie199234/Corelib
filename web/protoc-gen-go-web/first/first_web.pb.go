// Code generated by protoc-gen-go-web. DO NOT EDIT.

package first

import (
	//std
	"encoding/json"
	"net/http"
	"net/url"
	"strings"

	//third
	"github.com/chenjie199234/Corelib/web"
	"google.golang.org/protobuf/proto"

	//project
	"protoc-gen-go-web/second"
)

type WebTestService struct {
	Midware func() map[string][]web.OutsideHandler
	Hello   func(*web.Context, *HelloReq) (*HelloResp, error)
	Kiss    func(*web.Context, *second.KissReq) (*second.KissResp, error)
	Bye     func(*web.Context, *second.ByeReq) (*second.ByeResp, error)
}

func (s *WebTestService) hello(ctx *web.Context) {
	req := &HelloReq{}
	switch ctx.GetContentType() {
	case "":
		fallthrough
	case "application/x-www-form-urlencoded":
		encoded := true
		if data := ctx.GetForm("encode"); data == "0" {
			encoded = false
		}
		if data := ctx.GetForm("json"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = json.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		} else if data := ctx.GetForm("proto"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = proto.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	case "application/json":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := json.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		}
	case "application/x-protobuf":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := proto.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	default:
		ctx.WriteString(http.StatusBadRequest, "unknown Content-Type:"+ctx.GetContentType())
		return
	}
	resp, e := s.Hello(ctx, req)
	if e != nil {
		ctx.WriteString(http.StatusInternalServerError, e.Error())
		return
	}
	if strings.Contains(ctx.GetAcceptType(), "application/x-protobuf") {
		data, e := proto.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode proto response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	} else {
		data, e := json.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode json response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	}
}
func (s *WebTestService) kiss(ctx *web.Context) {
	req := &second.KissReq{}
	switch ctx.GetContentType() {
	case "":
		fallthrough
	case "application/x-www-form-urlencoded":
		encoded := true
		if data := ctx.GetForm("encode"); data == "0" {
			encoded = false
		}
		if data := ctx.GetForm("json"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = json.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		} else if data := ctx.GetForm("proto"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = proto.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	case "application/json":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := json.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		}
	case "application/x-protobuf":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := proto.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	default:
		ctx.WriteString(http.StatusBadRequest, "unknown Content-Type:"+ctx.GetContentType())
		return
	}
	resp, e := s.Kiss(ctx, req)
	if e != nil {
		ctx.WriteString(http.StatusInternalServerError, e.Error())
		return
	}
	if strings.Contains(ctx.GetAcceptType(), "application/x-protobuf") {
		data, e := proto.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode proto response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	} else {
		data, e := json.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode json response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	}
}
func (s *WebTestService) bye(ctx *web.Context) {
	req := &second.ByeReq{}
	switch ctx.GetContentType() {
	case "":
		fallthrough
	case "application/x-www-form-urlencoded":
		encoded := true
		if data := ctx.GetForm("encode"); data == "0" {
			encoded = false
		}
		if data := ctx.GetForm("json"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = json.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		} else if data := ctx.GetForm("proto"); data != "" {
			var e error
			if encoded {
				if data, e = url.QueryUnescape(data); e != nil {
					ctx.WriteString(http.StatusBadRequest, "encoded request data format error:"+e.Error())
					return
				}
			}
			if e = proto.Unmarshal(web.Str2byte(data), req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	case "application/json":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := json.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode json request data error:"+e.Error())
				return
			}
		}
	case "application/x-protobuf":
		if body, _ := ctx.GetBody(); len(body) > 0 {
			if e := proto.Unmarshal(body, req); e != nil {
				ctx.WriteString(http.StatusBadRequest, "decode proto request data error:"+e.Error())
				return
			}
		}
	default:
		ctx.WriteString(http.StatusBadRequest, "unknown Content-Type:"+ctx.GetContentType())
		return
	}
	resp, e := s.Bye(ctx, req)
	if e != nil {
		ctx.WriteString(http.StatusInternalServerError, e.Error())
		return
	}
	if strings.Contains(ctx.GetAcceptType(), "application/x-protobuf") {
		data, e := proto.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode proto response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	} else {
		data, e := json.Marshal(resp)
		if e != nil {
			ctx.WriteString(http.StatusInternalServerError, "encode json response data error:"+e.Error())
			return
		}
		ctx.Write(http.StatusOK, data)
	}
}

var PathWebTestHello = "/Test/Hello"
var PathWebTestKiss = "/Test/Kiss"
var PathWebTestBye = "/Test/Bye"

func RegisterWebTestService(engine *web.Web, instance *WebTestService) {
	var allmids map[string][]web.OutsideHandler
	if instance.Midware != nil {
		allmids = instance.Midware()
	}
	//Hello
	if instance.Hello == nil {
		engine.GET(PathWebTestHello, 200, func(ctx *web.Context) { ctx.WriteString(http.StatusNotFound, "method Hello not implemented") })
	} else if mids, ok := allmids[PathWebTestHello]; ok && len(mids) != 0 {
		engine.GET(PathWebTestHello, 200, append(mids, instance.hello)...)
	} else {
		engine.GET(PathWebTestHello, 200, instance.hello)
	}
	//Kiss
	if instance.Kiss == nil {
		engine.POST(PathWebTestKiss, 2000, func(ctx *web.Context) { ctx.WriteString(http.StatusNotFound, "method Kiss not implemented") })
	} else if mids, ok := allmids[PathWebTestKiss]; ok && len(mids) != 0 {
		engine.POST(PathWebTestKiss, 2000, append(mids, instance.kiss)...)
	} else {
		engine.POST(PathWebTestKiss, 2000, instance.kiss)
	}
	//Bye
	if instance.Bye == nil {
		engine.GET(PathWebTestBye, 200, func(ctx *web.Context) { ctx.WriteString(http.StatusNotFound, "method Bye not implemented") })
	} else if mids, ok := allmids[PathWebTestBye]; ok && len(mids) != 0 {
		engine.GET(PathWebTestBye, 200, append(mids, instance.bye)...)
	} else {
		engine.GET(PathWebTestBye, 200, instance.bye)
	}
}
